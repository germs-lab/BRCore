---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# BRCore

<!-- badges: start -->
[![R-CMD-check](https://github.com/germs-lab/BRCore/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/germs-lab/BRCore/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of BRCore is to aid the analysis of the [Inter BRC Microbiome project](https://github.com/germs-lab/interbrc-core-analysis) by providing a set of tools to process and analyze microbial data from Bioenergy Research Centers.

## Features

BRCore provides tools for:

- **Rarefaction analysis**: Calculate pre-rarefaction metrics (`add_rarefaction_metrics()`) and perform multiple rarefaction (`multi_rarefy()`)
- **Core microbiome identification**: Identify core microbial taxa using abundance-occupancy distributions (`identify_core()`)
- **Neutral model fitting**: Fit and visualize neutral community models (`fit_neutral_model()`, `plot_neutral_model()`)
- **Visualization**: Plot rarefaction diagnostics, abundance-occupancy curves, and core distributions (`plot_rarefaction_metrics()`, `plot_abundance_occupancy()`, `plot_core_distribution()`, `plot_identified_core()`)

## Installation

Install the development version of BRCore from GitHub with:

```{r}
# install.packages("pak")
pak::pak("germs-lab/BRCore")
```

## Quick Start

```{r}
library(BRCore)
library(phyloseq)

# Load example data
data("bcse", package = "BRCore")

# Add rarefaction metrics
bcse_metrics <- add_rarefaction_metrics(data = bcse)

# Perform multiple rarefaction
bcse_rarefied <- multi_rarefy(
  physeq = bcse,
  depth_level = 1000,
  num_iter = 100,
  threads = 4,
  set_seed = 7642
)

# Update phyloseq object with rarefied data
bcse_rare <- update_otu_table(physeq = bcse, otu_rare = bcse_rarefied)

# Identify core microbiome
bcse_core <- identify_core(
  physeq_obj = bcse_rare,
  priority_var = "Crop",
  increase_value = 0.02,
  seed = 2134
)

# Visualize abundance-occupancy distribution
plot_abundance_occupancy(core_result = bcse_core, core_set = "increase")

# Fit and plot neutral model
bcse_neutral <- fit_neutral_model(
  otu_table = bcse_core$otu_table,
  core_set = bcse_core$increase_core,
  abundance_occupancy = bcse_core$abundance_occupancy
)
plot_neutral_model(bcse_neutral)
```

## Documentation

For detailed documentation and examples, see the package vignette:

```{r}
vignette("BRCore-vignette", package = "BRCore")
```
